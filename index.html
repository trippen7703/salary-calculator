<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥æœŸå€é–“è–ªè³‡è¨ˆç®—å™¨</title>
    <style>
        /* ä¿æŒæ¨£å¼ä¸è®Š */
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 480px;
            margin: auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input[type="date"], input[type="number"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
            margin-top: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result-group {
            margin-top: 25px;
            border-top: 2px solid #ccc;
            padding-top: 20px;
        }
        .total-salary-box {
            padding: 15px;
            margin-bottom: 10px;
            border: 2px solid #28a745;
            border-radius: 4px;
            background-color: #e2f0e8;
            font-size: 1.1em;
            color: #155724;
            text-align: center;
        }
        .foreign-payout-box {
            padding: 15px;
            margin-bottom: 10px;
            border: 2px solid #6c757d; 
            border-radius: 4px;
            background-color: #f8f9fa;
            font-size: 1.1em;
            color: #343a40;
            text-align: center;
        }
        .balance-box {
            padding: 15px;
            border: 2px solid #007bff;
            border-radius: 4px;
            background-color: #e6f7ff;
            font-size: 1.2em;
            color: #0056b3;
            font-weight: bold;
            text-align: center;
        }
        .error {
            margin-top: 15px;
            padding: 10px;
            border: 1px solid #dc3545;
            background-color: #f8d7da;
            color: #721c24;
            border-radius: 4px;
            text-align: center;
            display: none;
        }
        .note {
            margin-top: 10px;
            font-size: 0.9em;
            color: #6c757d;
            text-align: center;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ’° è–ªè³‡è¨ˆç®—å™¨</h1>
    <div class="note">
        è¨ˆç®—é‚è¼¯ï¼šåŒ…å«ã€Œé–‹å§‹æ—¥æœŸã€ï¼Œä¸åŒ…å«ã€ŒçµæŸæ—¥æœŸã€ã€‚æ‰€æœ‰é‡‘é¡æ¡å››æ¨äº”å…¥å–æ•´æ•¸ã€‚
    </div>

    <label for="startDate">é–‹å§‹æ—¥æœŸï¼š</label>
    <input type="date" id="startDate"> <label for="endDate">çµæŸæ—¥æœŸï¼š</label>
    <input type="date" id="endDate"> <label for="totalDailySalary">ç¸½æ¯æ—¥è–ªè³‡ (å«å¤–å‹ï¼Œå…ƒ)ï¼š</label>
    <input type="number" id="totalDailySalary" min="0" value="1200">

    <label for="foreignWorkerDailySalary">å¤–å‹æ¯æ—¥è–ªè³‡ (å…ƒ)ï¼š</label>
    <input type="number" id="foreignWorkerDailySalary" min="0" value="1000">

    <button onclick="calculateSalary()">è¨ˆç®—çµæœ</button>

    <div class="result-group">
        <div class="total-salary-box" id="totalSalaryResult">
            ç¸½å¤©æ•¸ï¼š0 å¤© | ç¸½è–ªè³‡ï¼š0 å…ƒ
        </div>
        <div class="foreign-payout-box" id="foreignPayoutResult">
            æ”¯ä»˜å¤–å‹ç¸½é¡ï¼š0 å…ƒ
        </div>
        <div class="balance-box" id="companyBalanceResult">
            å…¬å¸çµé¤˜ï¼š0 å…ƒ
        </div>
    </div>

    <div class="error" id="errorMessage">
        </div>
</div>

<script>
    // å®šç¾©çµæœçš„é è¨­ HTML å…§å®¹ï¼Œæ–¹ä¾¿é‡è¨­
    const DEFAULT_RESULT_TOTAL = "ç¸½å¤©æ•¸ï¼š0 å¤© | ç¸½è–ªè³‡ï¼š0 å…ƒ";
    const DEFAULT_RESULT_PAYOUT = "æ”¯ä»˜å¤–å‹ç¸½é¡ï¼š0 å…ƒ";
    const DEFAULT_RESULT_BALANCE = "å…¬å¸çµé¤˜ï¼š0 å…ƒ";

    // è¼”åŠ©å‡½æ•¸ï¼šé‡è¨­æ‰€æœ‰çµæœå’ŒéŒ¯èª¤è¨Šæ¯
    function resetResults() {
        document.getElementById('totalSalaryResult').innerHTML = DEFAULT_RESULT_TOTAL;
        document.getElementById('foreignPayoutResult').innerHTML = DEFAULT_RESULT_PAYOUT;
        document.getElementById('companyBalanceResult').innerHTML = DEFAULT_RESULT_BALANCE;
        document.getElementById('errorMessage').style.display = 'none';
    }

    function displayError(message) {
        document.getElementById('errorMessage').innerHTML = message;
        document.getElementById('errorMessage').style.display = 'block';
    }

    function calculateSalary() {
        try {
            // é‡è¨­ä¸Šä¸€æ¬¡çš„çµæœ
            resetResults();

            // 1. å–å¾—è¼¸å…¥å€¼
            const startDateInput = document.getElementById('startDate').value;
            const endDateInput = document.getElementById('endDate').value;
            const totalDailySalaryInput = document.getElementById('totalDailySalary').value;
            const foreignWorkerDailySalaryInput = document.getElementById('foreignWorkerDailySalary').value;

            // å–å¾— DOM å…ƒç´ 
            const totalSalaryDiv = document.getElementById('totalSalaryResult');
            const foreignPayoutDiv = document.getElementById('foreignPayoutResult');
            const balanceDiv = document.getElementById('companyBalanceResult');

            // 2. åš´è¬¹çš„è¼¸å…¥å€¼æª¢æŸ¥
            if (!startDateInput || !endDateInput) {
                displayError("è«‹é¸æ“‡é–‹å§‹æ—¥æœŸå’ŒçµæŸæ—¥æœŸã€‚");
                return;
            }

            const totalDailySalary = parseFloat(totalDailySalaryInput);
            const foreignWorkerDailySalary = parseFloat(foreignWorkerDailySalaryInput);

            // æª¢æŸ¥æ•¸å­—æ˜¯å¦ç‚ºæœ‰æ•ˆã€éè² æ•¸ (DEBUG é—œéµé» A: ä½¿ç”¨ isFinite æª¢æŸ¥æ˜¯å¦ç‚ºåˆæ³•æ•¸å­—)
            if (!Number.isFinite(totalDailySalary) || totalDailySalary < 0 || !Number.isFinite(foreignWorkerDailySalary) || foreignWorkerDailySalary < 0) {
                displayError("æ¯æ—¥è–ªè³‡å¿…é ˆæ˜¯æœ‰æ•ˆçš„éè² æ•¸å­—ã€‚è«‹æª¢æŸ¥è¼¸å…¥ã€‚");
                return;
            }
            
            // 3. æ—¥æœŸç‰©ä»¶è™•ç†èˆ‡æª¢æŸ¥
            const startDate = new Date(startDateInput);
            const endDate = new Date(endDateInput);

            // æª¢æŸ¥æ—¥æœŸè½‰æ›æ˜¯å¦æˆåŠŸ (DEBUG é—œéµé» B: ç¢ºä¿æ—¥æœŸæœ‰æ•ˆ)
            if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
                displayError("è¼¸å…¥çš„æ—¥æœŸæ ¼å¼ç„¡æ•ˆã€‚è«‹ç¢ºä¿æ—¥æœŸé¸æ“‡æ­£ç¢ºã€‚");
                return;
            }
            
            // æ¨™æº–åŒ–æ—¥æœŸæ™‚é–“ (é¿å…æ™‚å€å•é¡Œå°è‡´å¤©æ•¸è¨ˆç®—éŒ¯èª¤)
            startDate.setHours(0, 0, 0, 0);
            endDate.setHours(0, 0, 0, 0);

            // 4. æ—¥æœŸé‚è¼¯é©—è­‰
            if (startDate >= endDate) {
                displayError("çµæŸæ—¥æœŸå¿…é ˆæ™šæ–¼é–‹å§‹æ—¥æœŸï¼Œå¦å‰‡å·¥ä½œå¤©æ•¸ç‚º 0ã€‚");
                return;
            }
            
            // 5. è¨ˆç®—å¤©æ•¸ (ä¸åŒ…å«çµ‚æ­¢æ—¥)
            const oneDay = 1000 * 60 * 60 * 24; 
            const differenceMs = endDate.getTime() - startDate.getTime();
            // Math.round ç”¨æ–¼è§£æ±ºå¯èƒ½çš„å¤ä»¤æ™‚ç­‰å¾®å°æ™‚é–“å·®ç•°å•é¡Œ
            const totalDays = Math.round(differenceMs / oneDay);
            
            // 6. è¨ˆç®—ç¸½è–ªè³‡èˆ‡çµé¤˜
            
            // åŸå§‹é‡‘é¡è¨ˆç®— (é¿å…åœ¨è¨ˆç®—ä¸­é–“é€²è¡Œå››æ¨äº”å…¥å°è‡´èª¤å·®)
            const rawTotalSalary = totalDays * totalDailySalary;
            const rawForeignWorkerPayout = totalDays * foreignWorkerDailySalary;
            const rawCompanyBalance = rawTotalSalary - rawForeignWorkerPayout;

            // æœ€çµ‚é‡‘é¡å››æ¨äº”å…¥å–æ•´æ•¸
            const totalSalary = Math.round(rawTotalSalary);
            const foreignWorkerPayout = Math.round(rawForeignWorkerPayout);
            const companyBalance = Math.round(rawCompanyBalance);

            // 7. é¡¯ç¤ºçµæœ
            totalSalaryDiv.innerHTML = `
                ç¸½å¤©æ•¸ï¼š<strong>${totalDays}</strong> å¤© | ç¸½è–ªè³‡ï¼š<strong>${totalSalary.toLocaleString()}</strong> å…ƒ
            `;
            
            foreignPayoutDiv.innerHTML = `
                æ”¯ä»˜å¤–å‹ç¸½é¡ï¼š<strong>${foreignWorkerPayout.toLocaleString()}</strong> å…ƒ
            `;
            
            balanceDiv.innerHTML = `
                å…¬å¸çµé¤˜ï¼š<strong>${companyBalance.toLocaleString()}</strong> å…ƒ
            `;
            
        } catch (error) {
            // æ•æ‰ä»»ä½•æœªé æ–™åˆ°çš„éŒ¯èª¤ï¼Œä¸¦é¡¯ç¤ºåœ¨éŒ¯èª¤æ¡†ä¸­
            console.error("è¨ˆç®—ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤:", error);
            displayError("ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥æ‚¨çš„è¼¸å…¥ä¸¦é‡æ–°å˜—è©¦ã€‚è©³ç´°éŒ¯èª¤å·²è¨˜éŒ„åœ¨ç€è¦½å™¨æ§åˆ¶å°ã€‚");
        }
    }
</script>

</body>
</html>